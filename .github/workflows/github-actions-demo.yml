name: GitHub Actions Demo
on: [push]
jobs:
  Explore-GitHub-Actions:
    runs-on: ubuntu-latest
    steps:
      # TESTINGS
      - run: echo "üéâ The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "üêß This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: echo "üîé The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
      - name: Check out repository code
        uses: actions/checkout@v2
      - run: echo "üí° The ${{ github.repository }} repository has been cloned to the runner."
      - run: echo "üñ•Ô∏è The workflow is now ready to test your code on the runner."
      - run: echo "üçè This job's status is ${{ job.status }}."
      # CACHE CONTROL
      - name: Cache
        uses: actions/cache@v2.1.6
        env:
          cache-name: cache-opam
        with:
          # A list of files, directories, and wildcard patterns to cache and restore
          path: ~/.opam
          # An explicit key for restoring and saving the cache
          key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ hashFiles('**/Makefile') }}
      - uses: actions/cache@v2
        with:
          path: vendor/bundle
          key: ${{ runner.os }}-gems-${{ hashFiles('**/Gemfile.lock') }}
          restore-keys: |
            ${{ runner.os }}-gems-
      # SETUP
      - name: Set up OCaml
        # You may pin to the exact commit or the version.
        # uses: ocaml/setup-ocaml@6d924c1a7769aa5cdd74bdd901f6e24eb05024b1
        uses: ocaml/setup-ocaml@v1.1.11
        with:
          # Version of the OCaml compiler to initialise
          ocaml-version: 4.12.0
      - run: opam install --yes cohttp-lwt-unix cohttp-async lambdasoup ocamlfind yojson lwt_ssl
      - name: Setup Ruby, JRuby and TruffleRuby
        uses: ruby/setup-ruby@v1.81.0
        with:
          ruby-version: 2.7.4
      - run: gem install jekyll bundler

      # OPERATIONS
      - run: git status
      - run: git submodules update
      - run: |
          cd text.sickhack.net
          bundle exec jekyll build

      # CHECK 
      - name: List files in the repository
        run: |
          ls -lha ${{ github.workspace }} ~/.opam ${{ github.workspace }}/text.sickhack.net 
